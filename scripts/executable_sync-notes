#!/bin/bash

set -euo pipefail

git pull --rebase
git add .

changed_files=$(git diff --cached --name-only)

if [[ -z "$changed_files" ]]; then
	echo "No changes to commit."
	exit 0
fi

obsidian_files=$(echo "$changed_files" | grep '^\.obsidian/' || true)
note_files=$(echo "$changed_files" | grep -v '^\.obsidian/' || true)

if [[ -n "$obsidian_files" ]]; then
	git commit -S -m "syncing obsidian settings"
fi

if [[ -n "$note_files" ]]; then
	git commit -S -m "syncing notes"
fi

git push
